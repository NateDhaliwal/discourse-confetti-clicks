<script type="text/discourse-plugin" version="1.14.0">
  // Load the external script
  var script = document.createElement('script');
  script.src = "https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js";
  document.head.appendChild(script);

  // Define settings variables outside of onload
  const confettiAmount = settings.confetti_amount; // Note: Removed interpolation syntax
  const confettiSpread = settings.confetti_spread; // Note: Removed interpolation syntax
  const allowedCategories = settings.allowed_in.split('|'); // Assuming `allowed_in` is a string of category names or IDs
  console.log(allowedCategories);
  console.log(`PAthname: ${window.location.pathname}`);
  // Wait for the script to load before using it
  script.onload = function() {
    // Check if we are on a topic page

    if (window.location.pathname.includes('/t/')) {
      // Assuming Discourse makes current category info available in a JavaScript variable
      // Simulating fetching category info (replace with actual method)
      let currentCategory = Discourse.__container__.lookup('controller:topic').get('category.id');
      console.log(`Current cat: ${currentCategory}`);
      if (allowedCategories.includes(currentCategory.toString())) {
        window.addEventListener('click', function (e) {
          let xpos = e.clientX;
          let ypos = e.clientY;
          window.confetti({ // Assume confetti is globally accessible after script load
            particleCount: confettiAmount,
            spread: confettiSpread,
            origin: { y: ypos/window.innerHeight , x: xpos/window.innerWidth },
          });
        });
      }
    }
  };
</script>
