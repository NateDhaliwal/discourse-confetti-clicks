<script type="text/discourse-plugin" version="1.14.0">
  // Load the external script
  var script = document.createElement('script');
  script.src = "https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js";
  document.head.appendChild(script);

  // Define settings variables outside of onload
  const confettiAmount = settings.confetti_amount; // Note: Removed interpolation syntax
  const confettiSpread = settings.confetti_spread; // Note: Removed interpolation syntax
  const allowedCategories = settings.allowed_in.split('|'); // Assuming `allowed_in` is a string of category names or IDs
  api.onPageChange((url, title) => {
    // Check for a topic page using the URL pattern or title
    if (url.includes('/t/') && api.getCurrentUser().get('username')) {

      let categoryName = api.getCurrentCategory().slug; // Use a similar method or accessor
      console.log(categoryName); // Verify in the console

      if (allowedCategories.includes(categoryName)) {
        window.addEventListener('click', function(e) {
          let xpos = e.clientX;
          let ypos = e.clientY;
          // Assuming 'confetti' script loaded
          window.confetti({
            particleCount: confettiAmount,
            spread: confettiSpread,
            origin: { y: ypos / window.innerHeight , x: xpos / window.innerWidth },
          });
        });
      }
    }
  });
</script>
